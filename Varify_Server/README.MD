# Verify Service 项目

基于 Node.js 开发的验证服务，提供用户身份验证、权限校验和邮件服务功能。

## 项目结构

text

```
verify-service/
├── index.js              # 服务主入口
├── email.js              # 邮件服务模块
├── const.js              # 常量定义
├── package.json          # 项目配置
└── proto/                # Protobuf文件目录
    └── message.proto     # 服务接口定义
```



## 功能特性

- 🔐 用户身份验证
- 📧 邮件发送服务
- 🔒 安全令牌管理
- 📊 请求日志记录
- 🔗 gRPC服务接口

## 技术栈

- **运行时**: Node.js
- **通信协议**: gRPC
- **邮件服务**: Nodemailer
- **包管理**: npm
- **UUID生成**: uuid库

## 快速开始

### 系统要求

1. Node.js (推荐 LTS 版本)
2. npm 包管理器

### 安装依赖

bash

```
cd verify-service
npm install
```



### 运行服务

bash

```
npm run serve
```



## 核心模块

### index.js - 服务主入口

gRPC服务实现，处理验证请求和业务逻辑。

**主要功能:**

- gRPC服务启动和监听
- 用户验证处理
- 令牌生成和验证
- 请求日志记录

### email.js - 邮件服务模块

负责邮件发送和相关功能。

**主要功能:**

- 邮件服务器配置
- 邮件模板管理
- 异步邮件发送
- 发送状态跟踪

### const.js - 常量定义

统一管理服务配置和常量。

**包含内容:**

- 服务端口配置
- 邮件服务器设置
- 令牌过期时间
- 错误码定义

## 配置说明

服务通过环境变量和常量文件进行配置：

### 服务配置

- `GRPC_PORT`: gRPC服务监听端口
- `SERVER_HOST`: 服务器主机地址

### 邮件配置

- `EMAIL_HOST`: 邮件服务器地址
- `EMAIL_PORT`: 邮件服务器端口
- `EMAIL_USER`: 发件人邮箱
- `EMAIL_PASS`: 邮箱密码

## API 接口

### 验证服务接口

#### VerifyUser - 用户验证

- **请求**: 用户凭证信息
- **响应**: 验证结果和令牌

#### SendVerifyEmail - 发送验证邮件

- **请求**: 用户邮箱地址
- **响应**: 发送状态

#### CheckToken - 令牌验证

- **请求**: 访问令牌
- **响应**: 验证结果和用户信息

## 开发指南

### 添加新的验证方式

1. 在 `index.js` 中添加新的验证处理函数
2. 更新 `message.proto` 定义新的服务接口
3. 实现对应的业务逻辑

### 扩展邮件功能

1. 在 `email.js` 中添加新的邮件模板
2. 实现邮件发送逻辑
3. 更新对应的服务调用

## 性能优化建议

1. **连接池管理**: 重用数据库和邮件服务器连接
2. **缓存策略**: 使用Redis缓存频繁验证的令牌
3. **异步处理**: 邮件发送采用异步非阻塞方式
4. **日志优化**: 合理设置日志级别，避免性能开销

## 故障排除

### 常见问题

1. **端口占用错误**
   - 检查端口是否被其他程序占用
   - 修改服务配置中的端口号
2. **邮件发送失败**
   - 检查邮件服务器配置
   - 验证网络连接和防火墙设置
3. **gRPC连接问题**
   - 检查客户端连接配置
   - 验证服务是否正常启动
4. **内存泄漏**
   - 使用Node.js内存分析工具
   - 检查未释放的资源引用

## 扩展功能

可以考虑添加以下功能增强服务能力:

1. **多因子认证**: 支持短信、生物识别等多因子验证
2. **风险控制**: 集成风险检测和异常登录告警
3. **审计日志**: 详细的用户操作审计功能
4. **第三方登录**: 支持OAuth、微信等第三方登录
5. **密码策略**: 可配置的密码强度和过期策略

## 许可证

MIT License - 详见项目 LICENSE 文件

## 支持

如有问题，请留言或提交Issue